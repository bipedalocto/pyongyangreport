<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FVTT TTRPG ë¡œê·¸ HTML ë³€í™˜ê¸°</title>
    <style>
        /* --- í˜ì´ì§€ ì „ì²´ ìŠ¤íƒ€ì¼ --- */
        :root {
            --bg-color: #1a1a1d;
            --primary-text-color: #f0f0f0;
            --secondary-text-color: #8c8c8e;
            --border-color: #434343;
            --container-bg: #2c2c2e;
            --button-bg: #4a4e69;
            --button-hover-bg: #6a6e99;
            --preview-border: #555;
            --system-message-bg: rgba(74, 78, 105, 0.2);
        }
        
        body {
            font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;
            background-color: var(--bg-color);
            color: var(--primary-text-color);
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }

        .main-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 25px;
            background-color: var(--container-bg);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        h1 {
            text-align: center;
            color: var(--primary-text-color);
            border-bottom: 2px solid var(--button-bg);
            padding-bottom: 10px;
            margin-top: 0;
        }

        p.instructions {
            text-align: center;
            color: var(--secondary-text-color);
            font-size: 0.9em;
        }
        
        textarea {
            width: 100%;
            height: 250px;
            box-sizing: border-box;
            background-color: var(--bg-color);
            color: var(--primary-text-color);
            border: 1px solid var(--border-color);
            border-radius: 5px;
            padding: 10px;
            font-size: 0.9em;
            margin-bottom: 15px;
            resize: vertical;
        }

        .button-group {
            text-align: center;
            margin-bottom: 25px;
        }

        button {
            background-color: var(--button-bg);
            color: white;
            border: none;
            padding: 12px 25px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 8px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: var(--button-hover-bg);
        }
        
        button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }

        #preview-container {
            border: 2px dashed var(--preview-border);
            padding: 20px;
            min-height: 150px;
            border-radius: 5px;
            background-color: var(--bg-color);
        }
        
        /* --- ë¯¸ë¦¬ë³´ê¸° & ê²°ê³¼ë¬¼ HTML ìŠ¤íƒ€ì¼ --- */
        .log-body {
            font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;
            background-color: #1a1a1d;
            color: #f0f0f0;
            padding: 20px;
        }

        .log-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #2c2c2e;
            padding: 20px;
            border-radius: 8px;
        }

        .message-block {
            margin-bottom: 18px;
            padding-bottom: 12px;
            border-bottom: 1px solid #434343;
            overflow: hidden; /* clearfix for floated timestamp */
        }
        
        .message-block:last-child {
            border-bottom: none;
        }

        .speaker {
            font-weight: bold;
            display: block;
            margin-bottom: 4px;
        }

        .timestamp {
            float: right;
            color: #8c8c8e;
            font-size: 0.75em;
            text-align: right;
            line-height: 1.3;
        }

        .content {
            font-size: 0.95em;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-right: 140px; /* íƒ€ì„ìŠ¤íƒ¬í”„ì™€ ê²¹ì¹˜ì§€ ì•Šë„ë¡ */
        }

        .system-message .content {
            font-style: italic;
            color: #a0a0c0;
            background-color: var(--system-message-bg);
            padding: 8px;
            border-radius: 4px;
        }

        /* ê¸´ ë©”ì‹œì§€ ì ‘ê¸°/í¼ì¹˜ê¸° ìŠ¤íƒ€ì¼ */
        .collapsible {
            max-height: 70px; /* ê¸°ë³¸ì ìœ¼ë¡œ ë³´ì¼ ìµœëŒ€ ë†’ì´ */
            overflow: hidden;
            position: relative;
            transition: max-height 0.4s ease-in-out;
        }

        .collapsible:hover {
            max-height: 1000px; /* í˜¸ë²„ ì‹œ í¼ì³ì§ˆ ìµœëŒ€ ë†’ì´ */
        }
        
        .collapsible::after {
            content: '... ë” ë³´ê¸°';
            position: absolute;
            bottom: 0;
            right: 0;
            left: 0;
            text-align: center;
            font-weight: bold;
            font-size: 0.8em;
            color: #aaa;
            height: 25px;
            background: linear-gradient(transparent, #2c2c2e 80%);
            pointer-events: none; /* í´ë¦­ ì´ë²¤íŠ¸ê°€ ë¶€ëª¨ë¡œ ì „ë‹¬ë˜ë„ë¡ */
            transition: opacity 0.2s;
        }
        
        .collapsible:hover::after {
            opacity: 0;
        }

    </style>
</head>
<body>

    <div class="main-container">
        <h1>ğŸ“œ FVTT ë¡œê·¸ HTML ë³€í™˜ê¸°</h1>
        <p class="instructions">ì•„ë˜ í…ìŠ¤íŠ¸ ì˜ì—­ì— Foundry VTTì˜ .txt ë¡œê·¸ íŒŒì¼ ë‚´ìš©ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”. <br> 'ë¯¸ë¦¬ë³´ê¸° ìƒì„±' ë²„íŠ¼ìœ¼ë¡œ ê²°ê³¼ë¥¼ í™•ì¸í•˜ê³ , 'HTML íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ' ë²„íŠ¼ìœ¼ë¡œ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

        <textarea id="logInput" placeholder="ì´ê³³ì— ë¡œê·¸ íŒŒì¼ ë‚´ìš©ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”."></textarea>
        
        <div class="button-group">
            <button onclick="generatePreview()">ë¯¸ë¦¬ë³´ê¸° ìƒì„±</button>
            <button id="downloadBtn" onclick="downloadHtmlFile()" disabled>HTML íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ</button>
        </div>

        <div id="preview-container">
            <p style="text-align:center; color: var(--secondary-text-color);">ë¯¸ë¦¬ë³´ê¸° ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
        </div>
    </div>
    
    <script>
        // ì˜ˆì‹œ ë¡œê·¸ ë°ì´í„°ë¥¼ textareaì— ë¯¸ë¦¬ ì±„ì›Œë„£ìŠµë‹ˆë‹¤.
        document.getElementById('logInput').value = `[9/1/2025, 8:09:49 PM] Gamemaster
{Game Time: Sep 01, 2085 00:02}
ì•„! ì˜¤ë„ì§œì„¸ê¸°í•© ë„˜ì¹˜ëŠ” í‰ì–‘ì˜ ê±´ì•„ë“¤ì´ì—¬!
---------------------------
[9/1/2025, 8:10:15 PM] Gamemaster
{Game Time: Sep 01, 2085 00:02}
ëŠ” ì•„ë‹ˆê³  ì•„ë¬´íŠ¼ ì—¬ëŸ¬ë¶„ì€ í‰ì–‘ì—ì„œ í•´ê²°ì‚¬, ê·¸ëŸ¬ë‹ˆê¹Œ ì§¬ì²˜ë¦¬ ì „ë¬¸ìš©ì—­ìœ¼ë¡œì„œ ì‚´ì•„ê°€ê³  ìˆì–´ìš”.
---------------------------
[9/1/2025, 8:10:57 PM] Gamemaster
{Game Time: Sep 01, 2085 00:02}
ë¨¼ì € ë¦¬=ì¼ì€ ë­ í•˜ëŠ” ë…„ì¸ê°€ìš”?
---------------------------
[9/1/2025, 8:11:08 PM] ë¦¬ ì¼
{Game Time: Sep 01, 2085 00:02}
ë¦¬-ì¼ì€ ìµœê·¼ ìœ í–‰í•˜ëŠ” ì‚¬ì´ë¹„ì— ì‹¬ì·¨í•œ ì• ì†¡ì´ì…ë‹ˆë‹¤
ë³€í™”êµë¼ëŠ” ì¢…êµì¸ë°
ìê¸° ìì‹ ì˜ ì´ì²´ì ì´ê³ ë„ ì—°ì†ì ì¸ ë³€í™”ë¥¼
ëª©í‘œë¡œ ì‚¼ëŠ” êµë¦¬ë¥¼ ê°€ì§€ê³  ìˆì–´ìš”
ì¹œêµ¬ë”°ë¼ ì „ë„ë°›ë‹¤ ëˆˆì´ ë²ˆì© ëœ¨ì¸ ë¦¬ ì¼ì€
ì•„ë¹ í•œí…Œ ë°›ì€ ìš©ëˆì„ ë‹¤ í„¸ì–´ì„œ
ê¸°ê³„íŒ” ë„¤ ê°œë¥¼ ì´ì‹ë°›ê¸°ë¡œ ê²°ì‹¬í•©ë‹ˆë‹¤
ê·¸ë¦¬ê³  í•˜ëŠ”ê¹€ì— ì¹¼ë‚ ë„ ê°™ì´ ë„£ì–´ì„œ
ë‹¤ìŒ ë³€í™”ë¥¼ ìœ„í•œ ì¬ë£Œê°’ë„ ì¢€ ë²Œê¸°ë¡œ í–ˆì–´ìš”
ì¢€ ìˆìœ¼ë©´ ê²½ì—°ì´ë¼ëŠ” í–‰ì‚¬ê°€ í‰ì–‘ì—ì„œ ì—´ë¦¬ëŠ”ë°
ë³€í™”êµì˜ êµë¥˜íšŒë¼ê³  ìƒê°í•˜ë©´ ë©ë‹ˆë‹¤
ì—¬ê¸°ì—ì„œ ì¡´ë‚˜ ë©‹ì§„ ë³€í™”ë¥¼ ë³´ì—¬ ì¤„ ìƒê°ì—
ë“¤ë– ìˆì–´ìš”
ì´ìƒ!!
---------------------------
[9/1/2025, 8:13:35 PM] Gamemaster
{Game Time: Sep 01, 2085 00:02}
ê·¸ëŸ¬ë‹ˆê¹Œ ì„¸ê¸°ë§ í”„ë¡œì‚¬ì´ë²„ ì‹ ì²œì§€ ì—´ì„±ì‹ ë„ë¼ëŠ” ê±°êµ°ìš”?
---------------------------
[9/1/2025, 8:21:49 PM] Gamemaster
{Game Time: Sep 01, 2085 00:02}
ê°ìì˜ ì‹œê¶ì°½ì—ì„œ íœ´ì‹ì„ ì·¨í•˜ë˜ ë„ì¤‘ ë™ë„¤ í˜ì„¼ í”½ì„œ ìì´ì¹˜í¬ì˜ ë‹¨ì²´ í™€ë¡œì½œ í˜¸ì¶œì„ ë°›ìŠµë‹ˆë‹¤.
---------------------------
[9/2/2025, 12:00:11 AM] ë°´ìŠ¤
{Game Time: Sep 01, 2085 00:02}
í”¼í† í•˜ë©° ë‹¤ìš´
---------------------------
[9/2/2025, 12:05:02 AM] ë¦¬ ì¼
{Game Time: Sep 01, 2085 00:02}
"ì‹œë°œ ë©”ë”•!!"
`;

        const speakerColors = {};
        const colorPalette = [
            '#ff8989', '#89c3ff', '#a2ff89', '#ff89f5', '#ffda89', 
            '#89fff3', '#e8aaff', '#b4c8aa', '#ffb2a4', '#a4dff3'
        ];
        let colorIndex = 0;

        function getSpeakerColor(speaker) {
            // GM, NPC ì´ë¦„ ë“± íŠ¹ì • ì´ë¦„ì— ê³ ì • ìƒ‰ìƒ ë¶€ì—¬
            const fixedColors = {
                'Gamemaster': '#e0e0e0',
                'ìì´ì¹˜í¬': '#f5a623',
                'ë¦¬ì»¤ì´': '#f8e71c',
                'ê¹¡íŒ¨': '#ff7675',
                'ì•¼ì˜¹ì´': '#fdcb6e',
                'SM58': '#74b9ff',
            };
            if (fixedColors[speaker]) {
                return fixedColors[speaker];
            }
            // í”Œë ˆì´ì–´ ìºë¦­í„°ë“¤ì—ê²Œ ìˆœì°¨ì ìœ¼ë¡œ ìƒ‰ìƒ í• ë‹¹
            if (!speakerColors[speaker]) {
                speakerColors[speaker] = colorPalette[colorIndex % colorPalette.length];
                colorIndex++;
            }
            return speakerColors[speaker];
        }

        function parseLog(rawLog) {
            // ì¼ê´€ì„±ì„ ìœ„í•´ íƒœê·¸ ì œê±°
            const cleanLog = rawLog.replace(/\\s*/g, '');
            const messages = cleanLog.split(/\s*---------------------------\s*/);
            
            let htmlContent = '';
            
            messages.forEach(msg => {
                if (msg.trim() === '') return;

                const lines = msg.trim().split('\n');
                const firstLine = lines.shift();

                const timeMatch = firstLine.match(/^\[(.*?)\]/);
                const speaker = firstLine.replace(/^\[.*?\]\s*/, '').trim();
                
                let gameTime = '';
                let content = lines.join('\n').trim();

                if (lines[0] && lines[0].startsWith('{Game Time:')) {
                    gameTime = lines.shift().replace(/[{}]/g, '').trim();
                    content = lines.join('\n').trim();
                }
                
                const timestamp = timeMatch ? timeMatch[1] : 'N/A';
                
                // ì‹œìŠ¤í…œ ë©”ì‹œì§€ (ì•„ì´í…œ ì¤ê¸° ë“±) íŒë³„
                const isSystemMessage = speaker.endsWith('picked up the following items:') || speaker.startsWith('#');
                const finalSpeaker = isSystemMessage ? 'System' : speaker;

                const color = getSpeakerColor(finalSpeaker);
                const isLong = content.split('\n').length > 4 || content.length > 250;
                
                htmlContent += `
                    <div class="message-block ${isSystemMessage ? 'system-message' : ''}">
                        <span class="timestamp">${timestamp}<br>${gameTime}</span>
                        <span class="speaker" style="color: ${color};">${finalSpeaker}</span>
                        <div class="content ${isLong ? 'collapsible' : ''}">${content}</div>
                    </div>
                `;
            });
            
            return htmlContent;
        }
        
        function generateFullHtml() {
            const rawLog = document.getElementById('logInput').value;
            // ìƒˆ ë¡œê·¸ ì²˜ë¦¬ ì‹œë§ˆë‹¤ ìƒ‰ìƒ í• ë‹¹ ì´ˆê¸°í™”
            Object.keys(speakerColors).forEach(key => delete speakerColors[key]);
            colorIndex = 0;

            const bodyContent = parseLog(rawLog);
            const styleContent = document.querySelector('style').innerHTML;

            return `
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>TTRPG ë¡œê·¸</title>
    <style>
        ${styleContent}
    </style>
</head>
<body class="log-body">
    <div class="log-container">
        <h1 style="text-align:center; border-bottom: 2px solid #4a4e69; padding-bottom: 10px;">ê²Œì„ ë¡œê·¸</h1>
        ${bodyContent}
    </div>
</body>
</html>
            `;
        }

        function generatePreview() {
            const rawLog = document.getElementById('logInput').value;
             // ìƒˆ ë¡œê·¸ ì²˜ë¦¬ ì‹œë§ˆë‹¤ ìƒ‰ìƒ í• ë‹¹ ì´ˆê¸°í™”
            Object.keys(speakerColors).forEach(key => delete speakerColors[key]);
            colorIndex = 0;

            const previewDiv = document.getElementById('preview-container');
            previewDiv.innerHTML = `<div class="log-container">${parseLog(rawLog)}</div>`;
            document.getElementById('downloadBtn').disabled = false;
        }

        function downloadHtmlFile() {
            const fullHtml = generateFullHtml();
            const blob = new Blob([fullHtml], { type: 'text/html' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'ttrpg_log.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

    </script>

</body>
</html>